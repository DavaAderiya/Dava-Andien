<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Album Lengkap - Dava & Andiena</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Poppins:wght@300;400;500;600&display=swap">
    <style>
        :root {
            --primary-color: #ff85a2;
            --secondary-color: #ffb6c1;
            --light-pink: #fff0f5;
            --soft-pink: #ffebf3;
            --dark-pink: #d87093;
            --text-color: #5a3a4c;
            --white: #ffffff;
            --shadow: 0 4px 12px rgba(255, 133, 162, 0.15);
            --transition: all 0.3s ease;
            --success-color: #4CAF50;
            --warning-color: #ff9800;
            --error-color: #f44336;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #fff5f9 0%, #ffe8f0 100%);
            color: var(--text-color);
            min-height: 100vh;
            overflow-x: hidden;
            font-size: 14px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            touch-action: manipulation;
        }
        
        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            opacity: 1;
            transition: opacity 0.8s ease;
        }
        
        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-heart {
            font-size: 5rem;
            color: white;
            margin-bottom: 2rem;
            animation: heartbeat 1.2s infinite ease-in-out;
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3); }
        }
        
        .loading-text {
            font-size: 1.5rem;
            color: white;
            font-family: 'Dancing Script', cursive;
            animation: fadeInOut 2s infinite;
        }
        
        @keyframes fadeInOut {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        /* Success Animation */
        .success-animation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2500;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }
        
        .success-heart {
            font-size: 4rem;
            color: var(--primary-color);
            animation: successHeart 1.5s ease forwards;
        }
        
        @keyframes successHeart {
            0% { 
                transform: scale(0.5); 
                opacity: 0; 
            }
            50% { 
                transform: scale(1.5); 
                opacity: 1; 
            }
            100% { 
                transform: scale(1); 
                opacity: 0; 
            }
        }
        
        .success-text {
            color: var(--primary-color);
            font-family: 'Dancing Script', cursive;
            font-size: 1.8rem;
            margin-top: 1rem;
            opacity: 0;
            animation: successText 1.5s ease 0.3s forwards;
        }
        
        @keyframes successText {
            0% { opacity: 0; transform: translateY(20px); }
            50% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-20px); }
        }
        
        /* Header Album */
        .album-header {
            position: relative;
            padding: 2rem 1rem 1rem;
            text-align: center;
            background: linear-gradient(to bottom, rgba(255, 133, 162, 0.1), rgba(255, 182, 193, 0.05));
            overflow: hidden;
        }
        
        .album-main-title {
            font-family: 'Dancing Script', cursive;
            font-size: 2.5rem;
            color: var(--dark-pink);
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .album-subtitle {
            font-size: 0.9rem;
            color: var(--text-color);
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.5;
        }
        
        /* Album Navigation */
        .album-nav {
            position: sticky;
            top: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            z-index: 100;
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 133, 162, 0.2);
            box-shadow: 0 4px 20px rgba(255, 133, 162, 0.1);
        }
        
        .album-nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .album-nav-title {
            font-family: 'Dancing Script', cursive;
            font-size: 1.5rem;
            color: var(--primary-color);
            font-weight: 700;
        }
        
        .album-nav-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        /* Filter bar */
        .album-filter {
            display: flex;
            gap: 0.5rem;
            overflow-x: auto;
            padding-bottom: 0.3rem;
            -webkit-overflow-scrolling: touch;
        }
        
        .album-filter::-webkit-scrollbar {
            height: 4px;
        }
        
        .album-filter::-webkit-scrollbar-track {
            background: rgba(255, 133, 162, 0.1);
            border-radius: 2px;
        }
        
        .album-filter::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 2px;
        }
        
        .filter-btn {
            padding: 0.5rem 1rem;
            border-radius: 1.5rem;
            background: var(--soft-pink);
            color: var(--text-color);
            border: 1px solid var(--secondary-color);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.85rem;
            white-space: nowrap;
            flex-shrink: 0;
            font-weight: 500;
            -webkit-tap-highlight-color: transparent;
        }
        
        .filter-btn:hover, .filter-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        /* View toggle bar */
        .view-toggle-bar {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.8rem;
            padding-top: 0.8rem;
            border-top: 1px solid rgba(255, 133, 162, 0.2);
        }
        
        .nav-btn {
            padding: 0.6rem 1.2rem;
            border-radius: 1.5rem;
            background: linear-gradient(135deg, var(--primary-color), var(--dark-pink));
            color: white;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            font-size: 0.85rem;
            flex-shrink: 0;
            box-shadow: var(--shadow);
            -webkit-tap-highlight-color: transparent;
        }
        
        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(255, 133, 162, 0.3);
        }
        
        /* Main Content */
        .album-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem 1rem;
        }
        
        /* Grid View */
        .grid-view {
            display: block;
        }
        
        .album-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
        }
        
        /* Album Card */
        .album-card {
            background: white;
            border-radius: 1rem;
            overflow: hidden;
            transition: var(--transition);
            border: 1px solid var(--secondary-color);
            cursor: pointer;
            position: relative;
            animation: cardAppear 0.6s ease forwards;
            opacity: 0;
            transform: translateY(20px);
            box-shadow: var(--shadow);
            -webkit-tap-highlight-color: transparent;
        }
        
        @keyframes cardAppear {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .album-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
            box-shadow: 0 10px 20px rgba(255, 133, 162, 0.2);
        }
        
        .card-media {
            position: relative;
            width: 100%;
            height: 150px;
            overflow: hidden;
        }
        
        .card-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.6s ease;
        }
        
        .album-card:hover .card-img {
            transform: scale(1.1);
        }
        
        /* Video Thumbnail Container */
        .video-thumbnail-container {
            position: relative;
            width: 100%;
            height: 100%;
            background: #f0f0f0;
        }
        
        .video-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .video-play-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }
        
        .album-card:hover .video-play-overlay {
            opacity: 1;
        }
        
        .play-button {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-size: 1.5rem;
            transition: transform 0.3s ease;
        }
        
        .album-card:hover .play-button {
            transform: scale(1.1);
        }
        
        .card-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(216, 112, 147, 0.9), transparent);
            padding: 1rem;
            transform: translateY(100%);
            transition: transform 0.4s ease;
        }
        
        .album-card:hover .card-overlay {
            transform: translateY(0);
        }
        
        .card-title {
            font-size: 0.9rem;
            margin-bottom: 0.3rem;
            color: white;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .card-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .card-btn {
            padding: 0.3rem 0.6rem;
            border-radius: 1rem;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            -webkit-tap-highlight-color: transparent;
        }
        
        .card-btn:hover {
            background: var(--primary-color);
            transform: scale(1.05);
        }
        
        .delete-btn:hover {
            background: #ff4d73;
        }
        
        .type-indicator {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            z-index: 2;
            background: white;
            color: var(--primary-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        /* Gallery View */
        .gallery-view {
            display: none;
        }
        
        .gallery-view.active {
            display: block;
        }
        
        .masonry-grid {
            columns: 4 120px;
            column-gap: 1rem;
        }
        
        .masonry-item {
            break-inside: avoid;
            margin-bottom: 1rem;
            border-radius: 0.8rem;
            overflow: hidden;
            cursor: pointer;
            transition: var(--transition);
            animation: masonryAppear 0.5s ease forwards;
            opacity: 0;
            transform: scale(0.9);
            box-shadow: var(--shadow);
        }
        
        @keyframes masonryAppear {
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .masonry-item:hover {
            transform: scale(1.03);
            box-shadow: 0 8px 16px rgba(255, 133, 162, 0.3);
        }
        
        .masonry-img {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 0.8rem;
        }
        
        /* Back to Home */
        .back-home {
            position: fixed;
            bottom: 1rem;
            left: 1rem;
            z-index: 100;
        }
        
        .back-btn {
            width: 3.2rem;
            height: 3.2rem;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--dark-pink));
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
            -webkit-tap-highlight-color: transparent;
        }
        
        .back-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(255, 133, 162, 0.3);
        }
        
        /* Add Content Button */
        .add-content-btn {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            z-index: 100;
        }
        
        .add-btn {
            width: 3.2rem;
            height: 3.2rem;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--success-color), #45a049);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
            -webkit-tap-highlight-color: transparent;
        }
        
        .add-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(76, 175, 80, 0.3);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }
        
        .modal-content {
            max-width: 90%;
            max-height: 90%;
            position: relative;
        }
        
        .modal-img {
            width: 100%;
            height: auto;
            border-radius: 0.8rem;
        }
        
        .modal-close {
            position: absolute;
            top: -2rem;
            right: 0;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            background: rgba(255, 133, 162, 0.8);
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: var(--transition);
            -webkit-tap-highlight-color: transparent;
        }
        
        .modal-close:hover {
            background: var(--primary-color);
            transform: rotate(90deg);
        }
        
        /* Add Content Modal */
        .form-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }
        
        .form-content {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 1rem;
            max-width: 500px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 10px 30px rgba(255, 133, 162, 0.2);
            -webkit-overflow-scrolling: touch;
        }
        
        .form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.2rem;
        }
        
        .form-title {
            font-family: 'Dancing Script', cursive;
            font-size: 1.5rem;
            color: var(--primary-color);
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-color);
            cursor: pointer;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: var(--transition);
            -webkit-tap-highlight-color: transparent;
        }
        
        .close-btn:hover {
            background: var(--soft-pink);
        }
        
        .upload-section {
            margin-top: 1.2rem;
            padding: 1rem;
            background: var(--soft-pink);
            border-radius: 0.7rem;
            border: 2px dashed var(--secondary-color);
        }
        
        .upload-title {
            font-size: 1rem;
            color: var(--primary-color);
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .upload-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.6rem;
            margin-bottom: 1rem;
        }
        
        .upload-option-btn {
            padding: 0.8rem;
            border: 2px solid var(--secondary-color);
            background: white;
            border-radius: 0.7rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            text-align: center;
            -webkit-tap-highlight-color: transparent;
        }
        
        .upload-option-btn:hover {
            border-color: var(--primary-color);
            background: var(--light-pink);
            transform: translateY(-2px);
        }
        
        .upload-option-btn.active {
            border-color: var(--primary-color);
            background: var(--light-pink);
        }
        
        .upload-option-btn i {
            font-size: 1.5rem;
            color: var(--primary-color);
        }
        
        .hidden-file-input {
            display: none;
        }
        
        .upload-preview {
            margin-top: 1rem;
            display: none;
        }
        
        .upload-preview.active {
            display: block;
        }
        
        .preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 0.6rem;
            margin-top: 0.6rem;
        }
        
        .preview-item {
            position: relative;
            width: 80px;
            height: 80px;
            border-radius: 0.5rem;
            overflow: hidden;
            border: 2px solid var(--secondary-color);
        }
        
        .preview-img, .preview-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .remove-preview {
            position: absolute;
            top: 0.2rem;
            right: 0.2rem;
            background: rgba(255, 107, 139, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 1.5rem;
            height: 1.5rem;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.7rem;
            z-index: 2;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Upload Loading Indicator */
        .upload-loading {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background: var(--soft-pink);
            border-radius: 0.7rem;
            text-align: center;
        }
        
        .upload-loading.active {
            display: block;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 2rem;
            height: 2rem;
            border: 3px solid var(--light-pink);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s linear infinite;
            margin-bottom: 0.5rem;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Progress Bar */
        .upload-progress {
            width: 100%;
            height: 0.5rem;
            background: var(--light-pink);
            border-radius: 0.25rem;
            margin-top: 0.5rem;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, var(--primary-color), var(--dark-pink));
            width: 0%;
            transition: width 0.3s ease;
        }
        
        /* Video Indicator */
        .video-indicator {
            position: absolute;
            top: 0.2rem;
            left: 0.2rem;
            background: rgba(255, 85, 162, 0.9);
            color: white;
            font-size: 0.6rem;
            padding: 0.2rem 0.4rem;
            border-radius: 0.3rem;
            display: flex;
            align-items: center;
            gap: 0.2rem;
            z-index: 1;
        }
        
        .url-input-group {
            margin-top: 1rem;
            display: none;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 1rem;
        }
        
        .form-label {
            margin-bottom: 0.4rem;
            font-weight: 600;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }
        
        .form-input, .form-textarea {
            padding: 0.6rem;
            border: 2px solid var(--secondary-color);
            border-radius: 0.6rem;
            font-family: 'Poppins', sans-serif;
            transition: var(--transition);
            background: white;
            font-size: 16px; /* Mencegah zoom di iOS */
        }
        
        .form-input:focus, .form-textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 133, 162, 0.1);
        }
        
        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.8rem;
            margin-top: 1.5rem;
            padding-top: 1.2rem;
            border-top: 1px solid var(--secondary-color);
        }
        
        .form-btn {
            padding: 0.6rem 1.2rem;
            border-radius: 0.6rem;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            -webkit-tap-highlight-color: transparent;
        }
        
        .form-btn.primary {
            background: linear-gradient(135deg, var(--primary-color), var(--dark-pink));
            color: var(--white);
        }
        
        .form-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .form-btn.secondary {
            background: var(--soft-pink);
            color: var(--text-color);
            border: 1px solid var(--secondary-color);
        }
        
        .form-btn.secondary:hover {
            background: var(--light-pink);
        }
        
        .form-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        /* File size indicator */
        .file-size-info {
            font-size: 0.75rem;
            color: var(--dark-pink);
            margin-top: 0.5rem;
            text-align: center;
        }
        
        /* Floating Hearts */
        .floating-hearts {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .heart {
            position: absolute;
            color: rgba(255, 133, 162, 0.2);
            font-size: 1rem;
            animation: floatHeart 15s infinite linear;
        }
        
        @keyframes floatHeart {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.3;
            }
            90% {
                opacity: 0.3;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            grid-column: 1 / -1;
        }
        
        .empty-state-icon {
            font-size: 3rem;
            color: var(--secondary-color);
            margin-bottom: 1rem;
        }
        
        .empty-state h3 {
            font-size: 1.2rem;
            margin-bottom: 0.8rem;
            color: var(--text-color);
        }
        
        .empty-state p {
            max-width: 300px;
            margin: 0 auto;
            color: var(--text-color);
            line-height: 1.5;
            font-size: 0.9rem;
            opacity: 0.7;
        }
        
        /* Delete Animation */
        @keyframes fadeOut {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(0.8); }
        }
        
        /* Message Notification */
        .message-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            z-index: 3000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            animation: slideIn 0.3s ease;
            color: white;
            max-width: 300px;
            font-weight: 500;
            text-align: center;
        }
        
        .message-notification.info {
            background: var(--primary-color);
        }
        
        .message-notification.warning {
            background: var(--warning-color);
        }
        
        .message-notification.error {
            background: var(--error-color);
        }
        
        .message-notification.success {
            background: var(--success-color);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        /* File Info */
        .file-info {
            font-size: 0.7rem;
            color: var(--text-color);
            opacity: 0.7;
            margin-top: 0.3rem;
            text-align: center;
            padding: 0 0.2rem;
            word-break: break-all;
        }
        
        /* Video Thumbnail Fallback */
        .video-thumbnail-fallback {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
        }
        
        /* YouTube Thumbnail */
        .youtube-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: #000;
        }
        
        /* ==================== RESPONSIVE ==================== */
        
        /* Tablet & HP */
        @media (max-width: 768px) {
            .album-main-title {
                font-size: 2rem;
            }
            
            .album-subtitle {
                font-size: 0.8rem;
            }
            
            .album-nav {
                padding: 0.8rem;
            }
            
            .album-nav-container {
                flex-direction: column;
                gap: 0.8rem;
                align-items: stretch;
            }
            
            .album-nav-title {
                font-size: 1.4rem;
                text-align: left;
                margin-bottom: 0;
                width: 100%;
                padding-bottom: 0.5rem;
                border-bottom: 1px solid rgba(255, 133, 162, 0.2);
            }
            
            .album-nav-controls {
                width: 100%;
                flex-direction: column;
                gap: 0.8rem;
            }
            
            .album-filter {
                width: 100%;
                justify-content: flex-start;
                gap: 0.4rem;
                overflow-x: auto;
                padding-bottom: 0.4rem;
            }
            
            .view-toggle-bar {
                width: 100%;
                justify-content: center;
                margin-top: 0.5rem;
                padding-top: 0.5rem;
            }
            
            .nav-btn {
                flex: 1;
                justify-content: center;
                font-size: 0.8rem;
                padding: 0.5rem 0.8rem;
            }
            
            .album-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 0.8rem;
            }
            
            .card-media {
                height: 120px;
            }
            
            .masonry-grid {
                columns: 2 100px;
                column-gap: 0.8rem;
            }
            
            .form-content {
                padding: 1rem;
                max-height: 90vh;
                margin: 0.5rem;
            }
            
            .upload-options {
                grid-template-columns: 1fr;
            }
            
            .message-notification {
                left: 1rem;
                right: 1rem;
                max-width: none;
                top: 10px;
            }
            
            .preview-container {
                grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
                gap: 0.5rem;
            }
            
            .preview-item {
                width: 70px;
                height: 70px;
            }
            
            .form-btn {
                padding: 0.8rem 1rem;
                font-size: 1rem;
                flex: 1;
            }
            
            .form-actions {
                gap: 0.5rem;
            }
            
            .play-button {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }
        }
        
        /* HP kecil */
        @media (max-width: 480px) {
            .album-main-title {
                font-size: 1.7rem;
            }
            
            .album-nav-title {
                font-size: 1.3rem;
            }
            
            .album-filter {
                gap: 0.3rem;
            }
            
            .filter-btn {
                padding: 0.4rem 0.7rem;
                font-size: 0.75rem;
            }
            
            .nav-btn {
                font-size: 0.75rem;
                padding: 0.4rem 0.6rem;
            }
            
            .album-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .masonry-grid {
                columns: 1;
            }
            
            .card-media {
                height: 100px;
            }
            
            .loading-heart {
                font-size: 4rem;
            }
            
            .loading-text {
                font-size: 1.2rem;
            }
            
            .back-home, .add-content-btn {
                bottom: 0.8rem;
            }
            
            .back-btn, .add-btn {
                width: 2.8rem;
                height: 2.8rem;
                font-size: 1rem;
            }
            
            .preview-container {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .upload-option-btn {
                padding: 1rem;
            }
            
            .form-btn {
                padding: 0.7rem 0.9rem;
                font-size: 0.9rem;
            }
            
            .play-button {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
        }
        
        /* Very small phones */
        @media (max-width: 360px) {
            .album-main-title {
                font-size: 1.5rem;
            }
            
            .album-nav-title {
                font-size: 1.2rem;
            }
            
            .album-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.6rem;
            }
            
            .preview-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .preview-item {
                width: 65px;
                height: 65px;
            }
            
            .form-content {
                padding: 0.8rem;
                margin: 0.3rem;
            }
            
            .play-button {
                width: 30px;
                height: 30px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-heart">
            <i class="fas fa-heart"></i>
        </div>
        <div class="loading-text">Memuat Album Kita...</div>
    </div>
    
    <!-- Success Animation -->
    <div class="success-animation" id="successAnimation" style="display: none;">
        <div class="success-heart">
            <i class="fas fa-heart"></i>
        </div>
        <div class="success-text">Tersimpan!</div>
    </div>
    
    <!-- Floating Hearts -->
    <div class="floating-hearts" id="floatingHearts"></div>
    
    <!-- Back to Home Button -->
    <div class="back-home">
        <button class="back-btn" id="backBtn" title="Kembali ke Beranda">
            <i class="fas fa-home"></i>
        </button>
    </div>
    
    <!-- Add Content Button -->
    <div class="add-content-btn">
        <button class="add-btn" id="addContentBtn" title="Tambah Kenangan">
            <i class="fas fa-plus"></i>
        </button>
    </div>
    
    <!-- Album Header -->
    <header class="album-header">
        <h1 class="album-main-title">Album Dava & Andiena</h1>
        <p class="album-subtitle">Kumpulan foto, video, dan kenangan indah kita bersama</p>
    </header>
    
    <!-- Album Navigation -->
    <nav class="album-nav">
        <div class="album-nav-container">
            <div class="album-nav-title">Love Story</div>
            
            <div class="album-nav-controls">
                <!-- Baris atas untuk filter -->
                <div class="album-filter">
                    <button class="filter-btn active" data-filter="all">Semua</button>
                    <button class="filter-btn" data-filter="photos">Foto</button>
                    <button class="filter-btn" data-filter="videos">Video</button>
                    <button class="filter-btn" data-filter="memories">Memori Spesial</button>
                    <button class="filter-btn" data-filter="favorites">Favorit</button>
                </div>
                
                <!-- Baris bawah untuk view toggle -->
                <div class="view-toggle-bar">
                    <button class="nav-btn" id="viewToggleBtn">
                        <i class="fas fa-th-large"></i> <span id="viewToggleText">Gallery</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="album-content">
        <!-- Grid View (Default) -->
        <div class="grid-view" id="gridView">
            <div class="album-grid" id="albumGridContainer">
                <!-- Album items akan dimuat di sini -->
            </div>
        </div>
        
        <!-- Gallery View -->
        <div class="gallery-view" id="galleryView">
            <div class="masonry-grid" id="masonryContainer">
                <!-- Masonry items akan dimuat di sini -->
            </div>
        </div>
    </main>
    
    <!-- Photo Modal -->
    <div class="modal" id="photoModal">
        <div class="modal-content">
            <span class="modal-close" id="modalClose">&times;</span>
            <img class="modal-img" id="modalImg" src="" alt="Foto Kenangan">
        </div>
    </div>
    
    <!-- Video Modal -->
    <div class="video-modal modal" id="videoModal">
        <div class="modal-content">
            <span class="modal-close" id="videoModalClose">&times;</span>
            <div class="video-modal-player" id="videoModalPlayer">
                <!-- Video akan dimuat di sini -->
            </div>
        </div>
    </div>
    
    <!-- Add Content Modal -->
    <div class="form-modal" id="addContentModal">
        <div class="form-content">
            <div class="form-header">
                <h3 class="form-title" id="formTitle">Tambah Kenangan</h3>
                <button class="close-btn" id="closeFormBtn">&times;</button>
            </div>
            
            <!-- Upload Section -->
            <div class="upload-section" id="uploadSection">
                <h3 class="upload-title"><i class="fas fa-upload"></i> Unggah Kenangan</h3>
                
                <div class="upload-options">
                    <button type="button" class="upload-option-btn active" id="uploadOption1">
                        <i class="fas fa-images"></i>
                        <span>Pilih File</span>
                        <small>Foto & Video</small>
                        <div class="file-size-info">Maks. 20MB per file</div>
                    </button>
                    <button type="button" class="upload-option-btn" id="uploadOption2">
                        <i class="fas fa-link"></i>
                        <span>Gunakan URL</span>
                        <small>Link Online</small>
                    </button>
                </div>
                
                <!-- Hidden File Input -->
                <input type="file" class="hidden-file-input" id="fileInput" accept="image/*,video/*,.mp4,.mov,.avi,.webm,.mkv" multiple>
                
                <!-- Preview -->
                <div class="upload-preview" id="uploadPreview">
                    <h4 style="font-size: 0.9rem; margin-bottom: 0.5rem;">Pratinjau:</h4>
                    <div class="preview-container" id="previewContainer">
                        <!-- Preview items akan ditambahkan di sini -->
                    </div>
                </div>
                
                <!-- Upload Loading Indicator -->
                <div class="upload-loading" id="uploadLoading">
                    <div class="loading-spinner"></div>
                    <p>Mengunggah file... <span id="loadingCount">0</span>/<span id="totalCount">0</span></p>
                    <div class="upload-progress">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                </div>
                
                <!-- URL Input -->
                <div class="url-input-group" id="urlInputGroup">
                    <div class="form-group">
                        <label class="form-label" for="itemUrl">
                            <i class="fas fa-link"></i> URL Gambar/Video
                        </label>
                        <input type="text" class="form-input" id="itemUrl" placeholder="Masukkan URL gambar atau video (YouTube, dll)">
                    </div>
                </div>
            </div>
            
            <!-- Form -->
            <form class="editor-form" id="itemForm">
                <input type="hidden" id="itemId" value="">
                <input type="hidden" id="itemType" value="photos">
                
                <div class="form-group">
                    <label class="form-label" for="itemTitle">
                        <i class="fas fa-heading"></i> Judul
                    </label>
                    <input type="text" class="form-input" id="itemTitle" placeholder="Masukkan judul (opsional)">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="itemDescription">
                        <i class="fas fa-align-left"></i> Deskripsi
                    </label>
                    <textarea class="form-textarea" id="itemDescription" placeholder="Tuliskan deskripsi (opsional)"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="form-btn secondary" id="cancelBtn">
                        <i class="fas fa-times"></i> Batal
                    </button>
                    <button type="submit" class="form-btn primary" id="saveBtn">
                        <i class="fas fa-save"></i> Simpan
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ==================== KONFIGURASI ====================
        const STORAGE_KEY = 'davaAndienaMemories';
        const MAX_FILE_SIZE = 20 * 1024 * 1024; // 20MB
        const MAX_FILES_MOBILE = 5; // Batas file untuk mobile
        
        // Data default dengan video thumbnail
        const defaultData = {
            photos: [
                {
                    id: 1,
                    src: "https://images.unsplash.com/photo-1518568814500-bf0f8d125f46?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    title: "Pertemuan Pertama",
                    description: "Momen pertama kali kita bertemu, senyummu begitu manis.",
                    date: "10-02-2023",
                    type: "photos",
                    favorite: true
                },
                {
                    id: 2,
                    src: "https://images.unsplash.com/photo-1511988617509-a57c8a288659?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    title: "Bersantai di Pantai",
                    description: "Hari yang indah di pantai bersama, matahari terbenam yang romantis.",
                    date: "15-03-2023",
                    type: "photos",
                    favorite: true
                }
            ],
            videos: [
                {
                    id: 1,
                    src: "https://www.youtube.com/embed/dQw4w9WgXcQ",
                    thumbnail: "https://img.youtube.com/vi/dQw4w9WgXcQ/maxresdefault.jpg",
                    title: "Video Spesial",
                    description: "Video kenangan indah kita bersama.",
                    date: "10-02-2024",
                    type: "videos",
                    favorite: true
                }
            ],
            memories: [
                {
                    id: 1,
                    photo: "https://images.unsplash.com/photo-1544005313-94ddf0286df2?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    title: "Pertama Kali Bertemu",
                    description: "Pertama kali kita bertemu, aku tak menyangka bahwa dirimu akan menjadi bagian terpenting dalam hidupku.",
                    date: "10-02-2023",
                    type: "memories",
                    favorite: true
                }
            ]
        };

        // ==================== STATE APLIKASI ====================
        let albumData = JSON.parse(localStorage.getItem(STORAGE_KEY)) || defaultData;
        let currentFilter = 'all';
        let isGalleryView = false;
        let allItems = [];
        
        // State untuk upload
        let uploadedFiles = [];
        let uploadedPreviewURLs = []; // Hanya untuk preview (objectURL)
        let currentUploadMode = 'gallery';
        let isUploading = false;
        
        let isEditing = false;
        let currentEditId = null;
        let currentEditType = null;
        
        // Deteksi device
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        const MAX_FILES = isMobile ? MAX_FILES_MOBILE : 10;

        // ==================== ELEMEN DOM ====================
        const loadingScreen = document.getElementById('loadingScreen');
        const successAnimation = document.getElementById('successAnimation');
        const floatingHearts = document.getElementById('floatingHearts');
        const backBtn = document.getElementById('backBtn');
        const addContentBtn = document.getElementById('addContentBtn');
        
        // Containers
        const albumGridContainer = document.getElementById('albumGridContainer');
        const masonryContainer = document.getElementById('masonryContainer');
        
        // Views
        const gridView = document.getElementById('gridView');
        const galleryView = document.getElementById('galleryView');
        
        // Navigation
        const filterBtns = document.querySelectorAll('.filter-btn');
        const viewToggleBtn = document.getElementById('viewToggleBtn');
        const viewToggleText = document.getElementById('viewToggleText');
        
        // Modals
        const photoModal = document.getElementById('photoModal');
        const modalImg = document.getElementById('modalImg');
        const modalClose = document.getElementById('modalClose');
        
        const videoModal = document.getElementById('videoModal');
        const videoModalPlayer = document.getElementById('videoModalPlayer');
        const videoModalClose = document.getElementById('videoModalClose');
        
        // Add Content Modal Elements
        const addContentModal = document.getElementById('addContentModal');
        const closeFormBtn = document.getElementById('closeFormBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const saveBtn = document.getElementById('saveBtn');
        const formTitle = document.getElementById('formTitle');
        const itemForm = document.getElementById('itemForm');
        const itemId = document.getElementById('itemId');
        const itemType = document.getElementById('itemType');
        const itemTitle = document.getElementById('itemTitle');
        const itemDescription = document.getElementById('itemDescription');
        const itemUrl = document.getElementById('itemUrl');
        
        // Upload elements
        const uploadOption1 = document.getElementById('uploadOption1');
        const uploadOption2 = document.getElementById('uploadOption2');
        const fileInput = document.getElementById('fileInput');
        const uploadPreview = document.getElementById('uploadPreview');
        const previewContainer = document.getElementById('previewContainer');
        const urlInputGroup = document.getElementById('urlInputGroup');
        
        // Loading elements
        const uploadLoading = document.getElementById('uploadLoading');
        const loadingCount = document.getElementById('loadingCount');
        const totalCount = document.getElementById('totalCount');
        const progressBar = document.getElementById('progressBar');

        // ==================== FUNGSI UTAMA ====================
        
        function init() {
            prepareAllItems();
            setupEventListeners();
            createFloatingHearts();
            loadContent();
            
            setTimeout(() => {
                loadingScreen.classList.add('hidden');
            }, 1000);
        }
        
        function saveData() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(albumData));
            } catch (e) {
                showMessage('Gagal menyimpan, storage penuh!', 'error');
            }
        }
        
        function prepareAllItems() {
            allItems = [];
            
            albumData.photos.forEach(photo => {
                allItems.push({
                    ...photo,
                    displayType: 'photo',
                    category: 'photos'
                });
            });
            
            albumData.videos.forEach(video => {
                allItems.push({
                    ...video,
                    displayType: 'video',
                    category: 'videos',
                    // Tambah thumbnail jika belum ada
                    thumbnail: video.thumbnail || getVideoThumbnail(video.src)
                });
            });
            
            albumData.memories.forEach(memory => {
                allItems.push({
                    ...memory,
                    displayType: 'memory',
                    src: memory.photo,
                    category: 'memories'
                });
            });
            
            allItems.sort((a, b) => b.id - a.id);
        }
        
        // ==================== FUNGSI THUMBNAIL VIDEO ====================
        
        // Fungsi untuk mendapatkan thumbnail video dari YouTube
        function getYouTubeThumbnail(url) {
            try {
                const videoId = extractYouTubeId(url);
                if (!videoId) return null;
                
                // Coba beberapa kualitas thumbnail YouTube
                const qualities = ['maxresdefault', 'hqdefault', 'mqdefault', 'sddefault'];
                
                for (const quality of qualities) {
                    const thumbnailUrl = `https://img.youtube.com/vi/${videoId}/${quality}.jpg`;
                    // Di production, Anda bisa melakukan HEAD request untuk cek apakah thumbnail ada
                    // Tapi untuk simplicity, kita langsung return
                    return thumbnailUrl;
                }
                
                return `https://img.youtube.com/vi/${videoId}/0.jpg`;
            } catch (error) {
                console.error('Error getting YouTube thumbnail:', error);
                return null;
            }
        }
        
        // Fungsi untuk generate thumbnail dari video file (dataURL)
        function generateVideoThumbnail(videoUrl) {
            return new Promise((resolve) => {
                // Jika YouTube URL, gunakan YouTube thumbnail
                if (videoUrl.includes('youtube.com') || videoUrl.includes('youtu.be')) {
                    const thumbnail = getYouTubeThumbnail(videoUrl);
                    if (thumbnail) {
                        resolve(thumbnail);
                        return;
                    }
                }
                
                // Jika dataURL (video yang diupload), coba buat thumbnail
                if (videoUrl.startsWith('data:video/')) {
                    const video = document.createElement('video');
                    video.src = videoUrl;
                    video.crossOrigin = 'anonymous';
                    
                    // Capture frame pertama
                    video.addEventListener('loadeddata', () => {
                        try {
                            // Set current time untuk ambil frame
                            video.currentTime = 0.1;
                        } catch (e) {
                            // Fallback jika gagal
                            resolve(null);
                        }
                    });
                    
                    video.addEventListener('seeked', () => {
                        try {
                            const canvas = document.createElement('canvas');
                            canvas.width = video.videoWidth || 300;
                            canvas.height = video.videoHeight || 200;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                            
                            const thumbnail = canvas.toDataURL('image/jpeg', 0.7);
                            resolve(thumbnail);
                        } catch (e) {
                            resolve(null);
                        }
                    });
                    
                    // Timeout fallback
                    setTimeout(() => {
                        resolve(null);
                    }, 2000);
                } else {
                    // Untuk URL video lain, gunakan fallback
                    resolve(null);
                }
            });
        }
        
        // Fungsi helper untuk mendapatkan thumbnail video
        function getVideoThumbnail(videoUrl) {
            // Jika sudah ada thumbnail di data, gunakan itu
            const videoItem = albumData.videos.find(v => v.src === videoUrl);
            if (videoItem && videoItem.thumbnail) {
                return videoItem.thumbnail;
            }
            
            // Jika YouTube, generate thumbnail URL
            if (videoUrl.includes('youtube.com') || videoUrl.includes('youtu.be')) {
                return getYouTubeThumbnail(videoUrl);
            }
            
            // Untuk video lain, return null (akan menggunakan fallback)
            return null;
        }
        
        // Extract YouTube ID
        function extractYouTubeId(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }
        
        function createFloatingHearts() {
            floatingHearts.innerHTML = '';
            
            for (let i = 0; i < 15; i++) {
                const heart = document.createElement('div');
                heart.className = 'heart';
                heart.innerHTML = '<i class="fas fa-heart"></i>';
                
                heart.style.left = `${Math.random() * 100}%`;
                heart.style.animationDelay = `${Math.random() * 5}s`;
                heart.style.animationDuration = `${10 + Math.random() * 10}s`;
                heart.style.fontSize = `${0.8 + Math.random() * 1}rem`;
                
                floatingHearts.appendChild(heart);
            }
        }
        
        // ==================== NOTIFICATION SYSTEM ====================
        
        function showMessage(text, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `message-notification ${type}`;
            notification.textContent = text;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease forwards';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // ==================== ANIMASI SUKSES ====================
        
        function showSuccessAnimation() {
            successAnimation.style.display = 'flex';
            
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    createFloatingSuccessHeart();
                }, i * 100);
            }
            
            setTimeout(() => {
                successAnimation.style.display = 'none';
            }, 2000);
        }
        
        function createFloatingSuccessHeart() {
            const heart = document.createElement('div');
            heart.innerHTML = '<i class="fas fa-heart"></i>';
            heart.style.cssText = `
                position: fixed;
                color: var(--primary-color);
                font-size: ${1 + Math.random() * 1}rem;
                top: 50%;
                left: 50%;
                z-index: 2501;
                animation: floatSuccessHeart 1.5s ease forwards;
            `;
            
            document.body.appendChild(heart);
            
            setTimeout(() => {
                if (heart.parentNode) {
                    heart.parentNode.removeChild(heart);
                }
            }, 1500);
        }
        
        // Tambahkan keyframe untuk animasi success heart
        const style = document.createElement('style');
        style.textContent = `
            @keyframes floatSuccessHeart {
                0% {
                    transform: translate(-50%, -50%) scale(0.5);
                    opacity: 1;
                }
                100% {
                    transform: translate(${Math.random() * 200 - 100}px, ${Math.random() * -100 - 50}px) scale(1);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
        
        // ==================== LOAD KONTEN ====================
        
        function loadContent() {
            if (isGalleryView) {
                loadMasonryItems();
            } else {
                loadGridItems();
            }
        }
        
        function loadGridItems() {
            albumGridContainer.innerHTML = '';
            const filteredItems = filterItems(allItems);
            
            if (filteredItems.length === 0) {
                albumGridContainer.innerHTML = createEmptyState('Tidak ada kenangan yang sesuai filter');
                return;
            }
            
            filteredItems.forEach((item, index) => {
                const card = createCardElement(item);
                card.style.animationDelay = `${index * 0.05}s`;
                albumGridContainer.appendChild(card);
            });
        }
        
        function loadMasonryItems() {
            masonryContainer.innerHTML = '';
            const filteredItems = filterItems(allItems);
            
            if (filteredItems.length === 0) {
                masonryContainer.innerHTML = createEmptyState('Tidak ada kenangan yang sesuai filter');
                return;
            }
            
            filteredItems.forEach((item, index) => {
                const masonryItem = createMasonryElement(item);
                masonryItem.style.animationDelay = `${index * 0.05}s`;
                masonryContainer.appendChild(masonryItem);
            });
        }
        
        function filterItems(items) {
            if (currentFilter === 'all') return items;
            if (currentFilter === 'favorites') return items.filter(item => item.favorite);
            return items.filter(item => item.category === currentFilter);
        }
        
        // ==================== ELEMEN KREATOR ====================
        
        function createCardElement(item) {
            const card = document.createElement('div');
            card.className = 'album-card';
            card.dataset.id = item.id;
            card.dataset.type = item.category;
            
            const isVideo = item.category === 'videos';
            const isMemory = item.category === 'memories';
            const typeIcon = isVideo ? 'fas fa-play' : (isMemory ? 'fas fa-heart' : 'fas fa-camera');
            
            let imgSrc = item.src;
            let isYouTube = false;
            let hasThumbnail = false;
            
            // Handle video thumbnail
            if (isVideo) {
                // Cek apakah ada thumbnail
                if (item.thumbnail) {
                    imgSrc = item.thumbnail;
                    hasThumbnail = true;
                } else if (item.src.includes('youtube.com') || item.src.includes('youtu.be')) {
                    // Generate YouTube thumbnail
                    const videoId = extractYouTubeId(item.src);
                    if (videoId) {
                        imgSrc = `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;
                        isYouTube = true;
                        hasThumbnail = true;
                    }
                }
                
                // Jika tidak ada thumbnail, gunakan fallback
                if (!hasThumbnail) {
                    imgSrc = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjNjY3ZWVhIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyNCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiPjx0c3BhbiBkeT0iLTAuNWVtIj7inaTvuI88L3RzcGFuPjx0c3BhbiBkeT0iMC41ZW0iPlZpZGVvPC90c3Bhbj48L3RleHQ+PC9zdmc+';
                }
            } else {
                // Untuk foto dan memori
                if (!imgSrc || imgSrc === '') {
                    imgSrc = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZmY4NWEyIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyNCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiPkZvdG8gS2VuYW5nYW48L3RleHQ+PC9zdmc+';
                }
            }
            
            card.innerHTML = `
                <div class="type-indicator">
                    <i class="${typeIcon}"></i>
                </div>
                
                <div class="card-media">
                    ${isVideo ? `
                        <div class="video-thumbnail-container">
                            ${hasThumbnail ? 
                                `<img src="${imgSrc}" alt="${item.title || 'Video'}" class="${isYouTube ? 'youtube-thumbnail' : 'video-thumbnail'}" loading="lazy">` :
                                `<div class="video-thumbnail-fallback">
                                    <i class="fas fa-play-circle"></i>
                                </div>`
                            }
                            <div class="video-play-overlay">
                                <div class="play-button">
                                    <i class="fas fa-play"></i>
                                </div>
                            </div>
                        </div>
                    ` : `
                        <img src="${imgSrc}" alt="${item.title || 'Kenangan'}" class="card-img" loading="lazy">
                    `}
                    
                    <div class="card-overlay">
                        <h3 class="card-title">${item.title || 'Tanpa Judul'}</h3>
                        <div class="card-actions">
                            <button class="card-btn view-btn" title="Lihat">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="card-btn favorite-btn" data-favorite="${item.favorite}" title="${item.favorite ? 'Hapus dari favorit' : 'Tambah ke favorit'}">
                                <i class="${item.favorite ? 'fas' : 'far'} fa-heart"></i>
                            </button>
                            <button class="card-btn delete-btn" title="Hapus">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            card.querySelector('.view-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                if (isVideo) {
                    playVideo(item);
                } else {
                    viewPhoto(item);
                }
            });
            
            // Tambah event listener untuk klik di area video
            if (isVideo) {
                card.querySelector('.video-thumbnail-container').addEventListener('click', (e) => {
                    e.stopPropagation();
                    playVideo(item);
                });
            } else {
                card.querySelector('.card-img').addEventListener('click', () => {
                    viewPhoto(item);
                });
            }
            
            card.querySelector('.favorite-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                toggleFavorite(item, card);
            });
            
            card.querySelector('.delete-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                deleteItem(item, card);
            });
            
            // Handle image error
            const imgElement = card.querySelector('img');
            if (imgElement) {
                imgElement.onerror = function() {
                    if (isVideo) {
                        this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjNjY3ZWVhIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyNCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiPjx0c3BhbiBkeT0iLTAuNWVtIj7inaTvuI88L3RzcGFuPjx0c3BhbiBkeT0iMC41ZW0iPlZpZGVvPC90c3Bhbj48L3RleHQ+PC9zdmc+';
                        this.style.objectFit = 'contain';
                        this.style.padding = '0.5rem';
                    } else {
                        this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZmY4NWEyIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyNCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiPkZvdG8gS2VuYW5nYW48L3RleHQ+PC9zdmc+';
                        this.style.objectFit = 'contain';
                        this.style.padding = '0.5rem';
                    }
                };
            }
            
            return card;
        }
        
        function createMasonryElement(item) {
            const masonryItem = document.createElement('div');
            masonryItem.className = 'masonry-item';
            masonryItem.dataset.id = item.id;
            masonryItem.dataset.type = item.category;
            
            const isVideo = item.category === 'videos';
            
            let imgSrc = item.src;
            
            // Handle video thumbnail untuk masonry
            if (isVideo) {
                if (item.thumbnail) {
                    imgSrc = item.thumbnail;
                } else if (item.src.includes('youtube.com') || item.src.includes('youtu.be')) {
                    const videoId = extractYouTubeId(item.src);
                    if (videoId) {
                        imgSrc = `https://img.youtube.com/vi/${videoId}/mqdefault.jpg`;
                    }
                }
                
                if (!imgSrc || imgSrc === item.src) {
                    imgSrc = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjNjY3ZWVhIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyNCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiPlZpZGVvPC90c3Bhbj48L3RleHQ+PC9zdmc+';
                }
            } else {
                if (!imgSrc || imgSrc === '') {
                    imgSrc = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZmY4NWEyIi8+PHRleHQgeD0iNUMlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyNCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiPkZvdG8gS2VuYW5nYW48L3RleHQ+PC9zdmc+';
                }
            }
            
            masonryItem.innerHTML = `
                <img src="${imgSrc}" alt="${item.title || 'Kenangan'}" class="masonry-img" loading="lazy">
                ${isVideo ? 
                    `<div style="position: absolute; top: 5px; right: 5px; background: var(--primary-color); color: white; padding: 3px 8px; border-radius: 15px; font-size: 0.7rem;">
                        <i class="fas fa-play"></i>
                    </div>` : 
                    ''
                }
            `;
            
            masonryItem.addEventListener('click', () => {
                if (isVideo) {
                    playVideo(item);
                } else {
                    viewPhoto(item);
                }
            });
            
            masonryItem.querySelector('.masonry-img').onerror = function() {
                if (isVideo) {
                    this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjNjY3ZWVhIi8+PHRleHQgeD0iNUMlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyNCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiPlZpZGVvPC90c3Bhbj48L3RleHQ+PC9zdmc+';
                } else {
                    this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZmY4NWEyIi8+PHRleHQgeD0iNUMlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyNCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiPkZvdG8gS2VuYW5nYW48L3RleHQ+PC9zdmc+';
                }
            };
            
            return masonryItem;
        }
        
        function createEmptyState(message) {
            return `
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="fas fa-images"></i>
                    </div>
                    <h3>${message}</h3>
                    <p>Klik tombol + untuk menambah kenangan baru.</p>
                    <button class="nav-btn" style="margin-top: 1rem;" onclick="openAddForm()">
                        <i class="fas fa-plus"></i> Tambah Kenangan
                    </button>
                </div>
            `;
        }
        
        // ==================== HAPUS KONTEN ====================
        
        function deleteItem(item, cardElement) {
            if (!confirm(`Hapus "${item.title || 'kenangan ini'}"?`)) return;
            
            if (item.category === 'photos') {
                const index = albumData.photos.findIndex(photo => photo.id === item.id);
                if (index !== -1) albumData.photos.splice(index, 1);
            } else if (item.category === 'videos') {
                const index = albumData.videos.findIndex(video => video.id === item.id);
                if (index !== -1) albumData.videos.splice(index, 1);
            } else if (item.category === 'memories') {
                const index = albumData.memories.findIndex(memory => memory.id === item.id);
                if (index !== -1) albumData.memories.splice(index, 1);
            }
            
            saveData();
            prepareAllItems();
            
            cardElement.style.animation = 'fadeOut 0.3s ease forwards';
            
            setTimeout(() => {
                if (cardElement.parentNode) {
                    cardElement.parentNode.removeChild(cardElement);
                }
                loadContent();
                
                const filteredItems = filterItems(allItems);
                if (filteredItems.length === 0) {
                    loadContent();
                }
            }, 300);
        }
        
        // ==================== FAVORITE SYSTEM ====================
        
        function toggleFavorite(item, cardElement) {
            item.favorite = !item.favorite;
            
            if (item.category === 'photos') {
                const photoIndex = albumData.photos.findIndex(photo => photo.id === item.id);
                if (photoIndex !== -1) albumData.photos[photoIndex].favorite = item.favorite;
            } else if (item.category === 'videos') {
                const videoIndex = albumData.videos.findIndex(video => video.id === item.id);
                if (videoIndex !== -1) albumData.videos[videoIndex].favorite = item.favorite;
            } else if (item.category === 'memories') {
                const memoryIndex = albumData.memories.findIndex(memory => memory.id === item.id);
                if (memoryIndex !== -1) albumData.memories[memoryIndex].favorite = item.favorite;
            }
            
            saveData();
            
            const favoriteBtn = cardElement.querySelector('.favorite-btn');
            if (item.favorite) {
                favoriteBtn.innerHTML = '<i class="fas fa-heart"></i>';
                favoriteBtn.dataset.favorite = 'true';
                favoriteBtn.title = 'Hapus dari favorit';
            } else {
                favoriteBtn.innerHTML = '<i class="far fa-heart"></i>';
                favoriteBtn.dataset.favorite = 'false';
                favoriteBtn.title = 'Tambah ke favorit';
            }
            
            if (currentFilter === 'favorites') {
                setTimeout(() => {
                    loadContent();
                }, 300);
            }
        }
        
        // ==================== MODAL FUNCTIONS ====================
        
        function viewPhoto(item) {
            modalImg.src = item.src;
            photoModal.style.display = 'flex';
        }
        
        function playVideo(video) {
            const videoId = extractYouTubeId(video.src);
            
            if (videoId) {
                videoModalPlayer.innerHTML = `
                    <iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen
                            style="width:100%; height:100%; min-height: 300px;">
                    </iframe>
                `;
            } else {
                videoModalPlayer.innerHTML = `
                    <video controls autoplay style="width:100%; height:100%; min-height: 300px;">
                        <source src="${video.src}" type="video/mp4">
                        Browser Anda tidak mendukung pemutaran video.
                    </video>
                `;
            }
            
            videoModal.style.display = 'flex';
        }
        
        // ==================== UPLOAD SYSTEM ====================
        
        function setupUploadSystem() {
            uploadOption1.addEventListener('click', () => {
                setUploadMode('gallery');
                fileInput.value = '';
                setTimeout(() => fileInput.click(), 100);
            }, { passive: true });
            
            uploadOption2.addEventListener('click', () => {
                setUploadMode('url');
            }, { passive: true });
            
            fileInput.addEventListener('change', handleFileSelect, { passive: true });
        }
        
        function setUploadMode(mode) {
            currentUploadMode = mode;
            
            [uploadOption1, uploadOption2].forEach(btn => btn.classList.remove('active'));
            
            if (mode === 'gallery') {
                uploadOption1.classList.add('active');
                uploadPreview.style.display = uploadedFiles.length > 0 ? 'block' : 'none';
                urlInputGroup.style.display = 'none';
                itemUrl.value = '';
            } else if (mode === 'url') {
                uploadOption2.classList.add('active');
                uploadPreview.style.display = 'none';
                urlInputGroup.style.display = 'block';
                clearPreview();
            }
        }
        
        async function handleFileSelect(e) {
            if (isUploading) {
                showMessage('Upload sedang berlangsung, tunggu hingga selesai', 'warning');
                e.target.value = '';
                return;
            }
            
            const files = Array.from(e.target.files);
            if (files.length === 0) return;
            
            if (isMobile && files.length > MAX_FILES) {
                showMessage(`Maksimal ${MAX_FILES} file untuk mobile`, 'warning');
                e.target.value = '';
                return;
            }
            
            const validFiles = files.filter(file => {
                const isImage = file.type.startsWith('image/') || 
                               /\.(jpg|jpeg|png|gif|bmp|webp)$/i.test(file.name);
                const isVideo = file.type.startsWith('video/') || 
                               /\.(mp4|mov|avi|webm|mkv|flv|wmv)$/i.test(file.name);
                return isImage || isVideo;
            });
            
            if (validFiles.length < files.length) {
                showMessage('Beberapa file tidak didukung. Hanya gambar (JPG, PNG, GIF) dan video (MP4, MOV, AVI) yang diperbolehkan.', 'warning');
            }
            
            if (validFiles.length === 0) {
                e.target.value = '';
                return;
            }
            
            const oversizedFiles = validFiles.filter(file => file.size > MAX_FILE_SIZE);
            if (oversizedFiles.length > 0) {
                showMessage(`Beberapa file melebihi 20MB: ${oversizedFiles.map(f => f.name).join(', ')}`, 'error');
                const validSizedFiles = validFiles.filter(file => file.size <= MAX_FILE_SIZE);
                if (validSizedFiles.length === 0) {
                    e.target.value = '';
                    return;
                }
                await processFiles(validSizedFiles);
            } else {
                await processFiles(validFiles);
            }
            
            e.target.value = '';
        }
        
        async function processFiles(files) {
            isUploading = true;
            clearPreview();
            
            uploadedFiles = [...files];
            uploadedPreviewURLs = [];
            
            uploadLoading.classList.add('active');
            totalCount.textContent = files.length;
            loadingCount.textContent = '0';
            progressBar.style.width = '0%';
            
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Memproses...';
            
            let processedCount = 0;
            
            for (let i = 0; i < files.length; i++) {
                try {
                    const file = files[i];
                    const objectURL = URL.createObjectURL(file);
                    uploadedPreviewURLs[i] = objectURL;
                    
                    addPreview(file, objectURL, i);
                    
                    processedCount++;
                    loadingCount.textContent = processedCount;
                    progressBar.style.width = `${(processedCount / files.length) * 100}%`;
                    
                    if (isMobile) {
                        await delay(50);
                    }
                    
                } catch (error) {
                    console.error('Error processing file:', error);
                    showMessage(`Gagal memproses file ke-${i + 1}`, 'error');
                }
            }
            
            uploadLoading.classList.remove('active');
            saveBtn.disabled = false;
            saveBtn.innerHTML = '<i class="fas fa-save"></i> Simpan';
            isUploading = false;
            
            uploadPreview.classList.add('active');
            
            showMessage(`Siap menyimpan ${files.length} file`, 'success');
        }
        
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        function addPreview(file, previewURL, index) {
            const preview = document.createElement('div');
            preview.className = 'preview-item mobile-optimized';
            preview.dataset.index = index;
            
            const isVideo = file.type.startsWith('video/') || 
                           /\.(mp4|mov|avi|webm|mkv|flv|wmv)$/i.test(file.name);
            
            const isImage = file.type.startsWith('image/') || 
                           /\.(jpg|jpeg|png|gif|bmp|webp)$/i.test(file.name);
            
            const fileName = file.name.length > 10 ? file.name.substring(0, 10) + '...' : file.name;
            const fileSize = (file.size / (1024 * 1024)).toFixed(2);
            
            if (isVideo) {
                preview.innerHTML = `
                    <video class="preview-video" preload="metadata">
                        <source src="${previewURL}" type="${file.type || 'video/mp4'}">
                    </video>
                    <div class="video-indicator">
                        <i class="fas fa-play"></i> Video
                    </div>
                    <div class="file-info">${fileName}<br>${fileSize} MB</div>
                    <button class="remove-preview" data-index="${index}">&times;</button>
                `;
            } else if (isImage) {
                preview.innerHTML = `
                    <img src="${previewURL}" class="preview-img" alt="Preview" loading="lazy">
                    <div class="file-info">${fileName}<br>${fileSize} MB</div>
                    <button class="remove-preview" data-index="${index}">&times;</button>
                `;
            }
            
            previewContainer.appendChild(preview);
            
            preview.querySelector('.remove-preview').addEventListener('click', (e) => {
                e.stopPropagation();
                e.preventDefault();
                removeFile(index);
            }, { passive: false });
        }
        
        function removeFile(index) {
            if (isUploading) {
                showMessage('Tunggu upload selesai sebelum menghapus file', 'warning');
                return;
            }
            
            if (uploadedPreviewURLs[index]) {
                URL.revokeObjectURL(uploadedPreviewURLs[index]);
            }
            
            uploadedFiles.splice(index, 1);
            uploadedPreviewURLs.splice(index, 1);
            
            clearPreview();
            
            if (uploadedFiles.length === 0) {
                uploadPreview.classList.remove('active');
                return;
            }
            
            uploadedFiles.forEach((file, idx) => {
                addPreview(file, uploadedPreviewURLs[idx], idx);
            });
            
            totalCount.textContent = uploadedFiles.length;
            loadingCount.textContent = uploadedFiles.length;
        }
        
        function clearPreview() {
            uploadedPreviewURLs.forEach(url => {
                if (url && url.startsWith('blob:')) {
                    URL.revokeObjectURL(url);
                }
            });
            
            previewContainer.innerHTML = '';
        }
        
        function resetUploadForm() {
            clearPreview();
            
            uploadedFiles = [];
            uploadedPreviewURLs = [];
            fileInput.value = '';
            uploadPreview.classList.remove('active');
            uploadLoading.classList.remove('active');
            urlInputGroup.style.display = 'none';
            itemUrl.value = '';
            isUploading = false;
            saveBtn.disabled = false;
            saveBtn.innerHTML = '<i class="fas fa-save"></i> Simpan';
            loadingCount.textContent = '0';
            totalCount.textContent = '0';
            progressBar.style.width = '0%';
        }
        
        // ==================== FORM HANDLING ====================
        
        function openAddForm() {
            resetUploadForm();
            isEditing = false;
            currentEditId = null;
            currentEditType = null;
            
            itemForm.reset();
            itemId.value = '';
            itemType.value = 'photos';
            setUploadMode('gallery');
            
            formTitle.textContent = 'Tambah Kenangan';
            addContentModal.style.display = 'flex';
        }
        
        itemForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            if (saveBtn.disabled) return;
            
            if (isUploading) {
                showMessage('File masih diproses, tunggu sebentar!', 'warning');
                return;
            }
            
            const type = itemType.value;
            const title = itemTitle.value.trim();
            const description = itemDescription.value.trim();
            const url = itemUrl.value.trim();
            
            if (currentUploadMode === 'url') {
                if (!url) {
                    showMessage('URL wajib diisi!', 'warning');
                    return;
                }
                
                if (!isValidURL(url)) {
                    showMessage('URL tidak valid. Harus dimulai dengan http://, https://, atau data:', 'warning');
                    return;
                }
                
                let itemTypeToUse = type;
                let thumbnail = null;
                
                if (!type || type === 'photos') {
                    if (url.includes('youtube.com') || url.includes('youtu.be') || url.includes('.mp4') || url.includes('.webm')) {
                        itemTypeToUse = 'videos';
                        // Generate thumbnail untuk YouTube
                        if (url.includes('youtube.com') || url.includes('youtu.be')) {
                            thumbnail = getYouTubeThumbnail(url);
                        }
                    } else if (url.includes('.jpg') || url.includes('.png') || url.includes('.jpeg') || url.includes('.gif')) {
                        itemTypeToUse = 'photos';
                    }
                }
                
                saveItemWithThumbnail(itemTypeToUse, title || 'Kenangan Baru', description, url, thumbnail);
                addContentModal.style.display = 'none';
                
                showSuccessAnimation();
                return;
            }
            
            if (uploadedFiles.length === 0) {
                showMessage('Pilih file terlebih dahulu!', 'warning');
                return;
            }
            
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Menyimpan...';
            
            await saveFilesDirect(uploadedFiles, type, title, description);
            
            itemForm.reset();
            resetUploadForm();
            
            setTimeout(() => {
                addContentModal.style.display = 'none';
                saveBtn.disabled = false;
                saveBtn.innerHTML = '<i class="fas fa-save"></i> Simpan';
                showSuccessAnimation();
            }, 500);
        });
        
        async function saveFilesDirect(files, type, title, description) {
            let savedCount = 0;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                try {
                    const dataUrl = await readFileAsDataURLChunked(file);
                    
                    const isVideoFile = file.type.startsWith('video/') || 
                                       /\.(mp4|mov|avi|webm|mkv|flv|wmv)$/i.test(file.name);
                    const isImageFile = file.type.startsWith('image/') || 
                                       /\.(jpg|jpeg|png|gif|bmp|webp)$/i.test(file.name);
                    
                    let itemTypeToUse = type;
                    let thumbnail = null;
                    
                    if (!type || type === 'photos') {
                        if (isVideoFile) {
                            itemTypeToUse = 'videos';
                            // Generate thumbnail untuk video
                            thumbnail = await generateVideoThumbnail(dataUrl);
                        } else if (isImageFile) {
                            itemTypeToUse = 'photos';
                        }
                    }
                    
                    let itemTitleText = title;
                    if (!itemTitleText) {
                        if (isImageFile) {
                            itemTitleText = itemTypeToUse === 'photos' ? 'Foto' : 'Memori Spesial';
                        } else if (isVideoFile) {
                            itemTitleText = 'Video';
                        } else {
                            itemTitleText = 'File Kenangan';
                        }
                    }
                    
                    if (files.length > 1 && title) {
                        itemTitleText = `${title} (${i + 1})`;
                    } else if (files.length > 1 && !title) {
                        itemTitleText = isImageFile ? `Foto ${i + 1}` : `Video ${i + 1}`;
                    }
                    
                    saveItemWithThumbnail(itemTypeToUse, itemTitleText, description, dataUrl, thumbnail);
                    savedCount++;
                    
                    await delay(isMobile ? 100 : 50);
                    
                } catch (error) {
                    console.error('Error saving file:', error);
                    showMessage(`Gagal menyimpan ${file.name}`, 'error');
                }
            }
            
            showMessage(`Berhasil menyimpan ${savedCount} dari ${files.length} file`, 'success');
        }
        
        function readFileAsDataURLChunked(file) {
            return new Promise((resolve, reject) => {
                if (file.size < 2 * 1024 * 1024) {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                    return;
                }
                
                if (isMobile) {
                    showMessage(`Memproses ${file.name} (file besar)...`, 'info');
                }
                
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        function isValidURL(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return string.startsWith('data:');
            }
        }
        
        // Fungsi baru: Simpan item dengan thumbnail
        function saveItemWithThumbnail(type, title, description, mediaUrl, thumbnail = null) {
            let newId = 1;
            
            if (type === 'photos' && albumData.photos.length > 0) {
                newId = Math.max(...albumData.photos.map(item => item.id)) + 1;
            } else if (type === 'videos' && albumData.videos.length > 0) {
                newId = Math.max(...albumData.videos.map(item => item.id)) + 1;
            } else if (type === 'memories' && albumData.memories.length > 0) {
                newId = Math.max(...albumData.memories.map(item => item.id)) + 1;
            }
            
            const today = new Date();
            const formattedDate = `${today.getDate().toString().padStart(2, '0')}-${(today.getMonth()+1).toString().padStart(2, '0')}-${today.getFullYear()}`;
            
            const newItem = {
                id: newId,
                title: title || (type === 'photos' ? 'Foto' : type === 'videos' ? 'Video' : 'Memori Spesial'),
                description: description || '',
                date: formattedDate,
                type: type,
                favorite: false
            };
            
            if (type === 'memories') {
                newItem.photo = mediaUrl;
            } else {
                newItem.src = mediaUrl;
                // Tambah thumbnail untuk video
                if (type === 'videos' && thumbnail) {
                    newItem.thumbnail = thumbnail;
                }
            }
            
            if (type === 'photos') {
                albumData.photos.push(newItem);
            } else if (type === 'videos') {
                albumData.videos.push(newItem);
            } else if (type === 'memories') {
                albumData.memories.push(newItem);
            }
            
            saveData();
            prepareAllItems();
            loadContent();
        }
        
        // ==================== VIEW TOGGLE ====================
        
        function toggleView() {
            isGalleryView = !isGalleryView;
            
            if (isGalleryView) {
                gridView.style.display = 'none';
                galleryView.classList.add('active');
                viewToggleText.textContent = 'Grid';
                viewToggleBtn.querySelector('i').className = 'fas fa-th';
                loadMasonryItems();
            } else {
                galleryView.classList.remove('active');
                gridView.style.display = 'block';
                viewToggleText.textContent = 'Gallery';
                viewToggleBtn.querySelector('i').className = 'fas fa-th-large';
                loadGridItems();
            }
        }
        
        // ==================== FUNGSI HOME BUTTON ====================
        
        function goToHomePage() {
            loadingScreen.classList.remove('hidden');
            loadingScreen.style.opacity = '1';
            
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 800);
        }
        
        // ==================== EVENT LISTENERS ====================
        
        function setupEventListeners() {
            backBtn.addEventListener('click', goToHomePage, { passive: true });
            addContentBtn.addEventListener('click', openAddForm, { passive: true });
            
            filterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    filterBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.filter;
                    loadContent();
                }, { passive: true });
            });
            
            viewToggleBtn.addEventListener('click', toggleView, { passive: true });
            
            modalClose.addEventListener('click', () => {
                photoModal.style.display = 'none';
            }, { passive: true });
            
            photoModal.addEventListener('click', (e) => {
                if (e.target === photoModal) {
                    photoModal.style.display = 'none';
                }
            }, { passive: true });
            
            videoModalClose.addEventListener('click', () => {
                videoModal.style.display = 'none';
                videoModalPlayer.innerHTML = '';
            }, { passive: true });
            
            videoModal.addEventListener('click', (e) => {
                if (e.target === videoModal) {
                    videoModal.style.display = 'none';
                    videoModalPlayer.innerHTML = '';
                }
            }, { passive: true });
            
            closeFormBtn.addEventListener('click', () => {
                addContentModal.style.display = 'none';
            }, { passive: true });
            
            cancelBtn.addEventListener('click', () => {
                addContentModal.style.display = 'none';
            }, { passive: true });
            
            addContentModal.addEventListener('click', (e) => {
                if (e.target === addContentModal) {
                    addContentModal.style.display = 'none';
                }
            }, { passive: true });
            
            setupUploadSystem();
            
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    photoModal.style.display = 'none';
                    videoModal.style.display = 'none';
                    addContentModal.style.display = 'none';
                }
            }, { passive: true });
            
            let isSubmitting = false;
            itemForm.addEventListener('submit', function(e) {
                if (isSubmitting) {
                    e.preventDefault();
                    return;
                }
                isSubmitting = true;
                
                setTimeout(() => {
                    isSubmitting = false;
                }, 3000);
            }, { passive: false });
        }
        
        // ==================== CLEANUP ====================
        
        window.addEventListener('beforeunload', function() {
            uploadedPreviewURLs.forEach(url => {
                if (url && url.startsWith('blob:')) {
                    URL.revokeObjectURL(url);
                }
            });
        }, { passive: true });
        
        // ==================== INITIALIZATION ====================
        
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>